<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>&#x6280;&#x672f;&#x603b;&#x89c8;&#xff08;&#x5f15;&#x64ce;&#x4e0e;&#x7f16;&#x8f91;&#x5668;&#xff09;</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="技术总览引擎与编辑器">技术总览（引擎与编辑器）</h1>
<p>本文档总结本项目当前的技术栈、工程结构、核心架构、运行生命周期、关键调用关系，并整理常用 OpenGL/GLM/ImGui 相关知识点，便于快速上手与维护。</p>
<hr>
<h2 id="1-技术栈一览">1) 技术栈一览</h2>
<ul>
<li>语言与构建
<ul>
<li>C++17</li>
<li>CMake + MSBuild（Windows）</li>
<li>vcpkg 清单模式（<code>vcpkg.json</code>）</li>
</ul>
</li>
<li>第三方库（按用途）
<ul>
<li>渲染：OpenGL 4.x（GLAD 加载）</li>
<li>窗口与输入：GLFW</li>
<li>数学：GLM</li>
<li>UI：Dear ImGui（Docking）</li>
<li>纹理：stb_image</li>
<li>日志与格式化：spdlog, fmt</li>
</ul>
</li>
<li>运行形态
<ul>
<li>原生桌面应用（TemplateProject.exe）</li>
<li>内嵌编辑器 UI（DockSpace + 多面板）</li>
</ul>
</li>
</ul>
<hr>
<h2 id="2-项目目录结构精简">2) 项目/目录结构（精简）</h2>
<ul>
<li>顶层
<ul>
<li><code>CMakeLists.txt</code> / <code>CMakePresets.json</code> / <code>build.py</code>/<code>build_py.bat</code></li>
<li><code>vcpkg/</code>（本地 vcpkg）</li>
<li><code>build/</code>（生成目录，区分 x64-debug / x64-release）</li>
<li><code>Docs/</code>（文档）</li>
</ul>
</li>
<li>Engine/
<ul>
<li><code>src/Engine.h</code>（聚合头）</li>
<li><code>src/Himii/Core</code>：Application、Layer、LayerStack、Window、Log、Event 等</li>
<li><code>src/Himii/Renderer</code>：Renderer、RenderCommand、Shader、Texture、Buffer、VertexArray、Framebuffer（抽象）等</li>
<li><code>src/Platform/OpenGL</code>：OpenGL 具体实现（Buffer/VertexArray/Shader/Texture/Framebuffer 等）</li>
<li><code>vender/imgui</code>：ImGui 集成</li>
</ul>
</li>
<li>TemplateProject/
<ul>
<li>Demo/编辑器层：<code>EditorLayer.*</code>、<code>CubeLayer.*</code>、<code>Example*</code> 等</li>
<li>资源与着色器：<code>assets/</code>（textures/shaders/fonts）</li>
</ul>
</li>
</ul>
<hr>
<h2 id="3-模块与架构">3) 模块与架构</h2>
<ul>
<li>Core（跨平台层）
<ul>
<li>Application：主循环、层管理（LayerStack）与事件派发</li>
<li>Layer：抽象生命周期接口（OnAttach/OnUpdate/OnDetach/OnImGuiRender/OnEvent）</li>
<li>Window/Input/Events：窗口、输入、事件类型（如 WindowResizeEvent）</li>
</ul>
</li>
<li>Renderer（API 无关抽象）
<ul>
<li>RenderCommand：封装清屏/视口/DrawIndexed 等</li>
<li>Shader/Texture/Buffer/VertexArray：渲染资源抽象</li>
<li>Framebuffer：离屏渲染目标抽象（颜色附件 + 深度/模板）</li>
<li>Renderer：BeginScene/Submit/EndScene（设置 VP 矩阵与批量提交）</li>
</ul>
</li>
<li>Platform.OpenGL（后端实现）
<ul>
<li>OpenGLFramebuffer：FBO + 颜色纹理（RGBA8）+ 深度模板 RBO（DEPTH24_STENCIL8），Bind 时设置 Viewport</li>
<li>其它 GL 对象：VAO/VBO/IBO/Shader/Texture 的 OpenGL 实现</li>
</ul>
</li>
<li>UI/Editor（基于 ImGui）
<ul>
<li>DockSpace 顶部菜单条 + 面板系统</li>
<li>Scene/Game 视图面板（通过 ImGui::Image 展示 FBO 颜色纹理）</li>
</ul>
</li>
<li>示例/玩法层（TemplateProject）
<ul>
<li>CubeLayer：地形生成与渲染、相机、离屏渲染驱动</li>
<li>EditorLayer：面板布局、尺寸/焦点/悬停状态回传、接收 FBO 纹理</li>
</ul>
</li>
</ul>
<hr>
<h2 id="4-生命周期运行时">4) 生命周期（运行时）</h2>
<ol>
<li>启动
<ul>
<li>初始化日志、窗口、OpenGL（GLAD）、ImGui 等</li>
<li>装载 Layer：如 CubeLayer（场景逻辑）、EditorLayer（编辑器 UI）</li>
</ul>
</li>
<li>主循环（Application::Run，伪代码）
<ul>
<li>处理系统事件 → 分发到各 Layer::OnEvent</li>
<li>计算 DeltaTime（Timestep）</li>
<li>遍历 LayerStack 调用 OnUpdate(ts)</li>
<li>开始 ImGui 帧 → 遍历调用 OnImGuiRender() → 渲染 ImGui</li>
</ul>
</li>
<li>退出
<ul>
<li>逆序 Detach 层、释放资源</li>
</ul>
</li>
</ol>
<p>常见 Layer 生命周期钩子：</p>
<ul>
<li>OnAttach：创建资源（VAO/VBO/IBO、Shader、Texture、Framebuffer 等）</li>
<li>OnUpdate(ts)：更新输入/相机、执行渲染（含离屏渲染）</li>
<li>OnImGuiRender：参数面板、视图面板等 UI</li>
<li>OnDetach：释放资源</li>
</ul>
<hr>
<h2 id="5-典型调用路径渲染帧">5) 典型调用路径（渲染帧）</h2>
<ul>
<li>输入/相机
<ul>
<li>EditorLayer 提供 Scene/Game 面板尺寸与悬停/聚焦标记</li>
<li>CubeLayer::OnUpdate：当 Scene 悬停/聚焦时响应 WASD + 右键鼠标以更新相机</li>
</ul>
</li>
<li>离屏渲染
<ul>
<li>获取面板期望尺寸 → 调整各自 FBO（Scene/Game）</li>
<li>计算投影矩阵：<code>glm::perspective&lt;float&gt;(fov, aspect, near, far)</code></li>
<li>计算视图矩阵：<code>glm::lookAt(pos, target, up)</code></li>
<li>Renderer::BeginScene(viewProj)
<ul>
<li>先渲染天空盒（深度函数 LEQUAL + 深度写禁用）</li>
<li>再渲染体素地形（光照/法线/纹理图集）</li>
</ul>
</li>
<li>Renderer::EndScene()；FBO::Unbind()</li>
</ul>
</li>
<li>UI 展示
<ul>
<li>EditorLayer 读取 FBO 颜色纹理 ID → ImGui::Image 翻转 UV（(0,1)-(1,0)）显示</li>
</ul>
</li>
</ul>
<hr>
<h2 id="6-主要子系统要点">6) 主要子系统要点</h2>
<h3 id="61-帧缓冲framebuffer">6.1 帧缓冲（Framebuffer）</h3>
<ul>
<li>抽象接口：Bind/Unbind/Resize/GetColorAttachmentRendererID/GetSpecification</li>
<li>规格（Specification）：<code>Width/Height</code></li>
<li>OpenGL 实现（OpenGLFramebuffer）
<ul>
<li>颜色附件：2D 纹理 RGBA8</li>
<li>深度模板：Renderbuffer DEPTH24_STENCIL8</li>
<li>Invalidate()：在 Resize 时销毁并重建附件</li>
<li>Bind()：glBindFramebuffer + glViewport(0,0,w,h)</li>
</ul>
</li>
</ul>
<h3 id="62-渲染资源">6.2 渲染资源</h3>
<ul>
<li>Buffer/VertexArray：设置 BufferLayout，按顺序绑定属性（位置/法线/颜色/UV/索引等）</li>
<li>Shader：统一设置采样器数组 <code>u_Texture[0..31]</code>，<code>SetIntArray</code> 绑定到纹理单元</li>
<li>Texture：stb_image 加载，支持图集；渲染时按图集中 UV 采样</li>
</ul>
<h3 id="63-编辑器面板">6.3 编辑器面板</h3>
<ul>
<li>Scene 面板：主要用于操控相机</li>
<li>Game 面板：展示相同场景的独立离屏结果（可扩展为独立相机）</li>
<li>面板尺寸变化 → 触发对应 FBO Resize，保持清晰度与正确纵横比</li>
</ul>
<hr>
<h2 id="7-地形生成概览">7) 地形生成（概览）</h2>
<ul>
<li>体素化：仅发射可见面的网格，极大降低三角形数</li>
<li>噪声层次
<ul>
<li>Plains（fBm）与 Mountain（Ridged）按 biome 混合</li>
<li>Continent（低频）塑造大陆与海洋格局</li>
<li>Detail + Warp 消除网格感并增加细节</li>
</ul>
</li>
<li>形状整形
<ul>
<li>Plateau（台地分段）、CurveExponent（分布曲线）、ValleyDepth（谷地加深）、SeaLevel（海平面）</li>
</ul>
</li>
<li>UV 图集
<ul>
<li>为不同面（顶/底/侧）选取不同 tile；支持 padding 避免采样污染</li>
</ul>
</li>
</ul>
<hr>
<h2 id="8-天空盒与光照">8) 天空盒与光照</h2>
<ul>
<li>天空盒：程序化渐变（Top/Horizon/Bottom），以相机位置为中心的大立方体
<ul>
<li>绘制时：<code>glDepthFunc(GL_LEQUAL) + glDepthMask(GL_FALSE)</code>，避免遮挡前景物体</li>
</ul>
</li>
<li>光照（简化）
<ul>
<li>环境光（颜色+强度）</li>
<li>定向光（方向+颜色+强度）</li>
<li>在 <code>LitTexture.glsl</code> 中进行漫反射近似</li>
</ul>
</li>
</ul>
<hr>
<h2 id="9-openglglmimgui-知识点速查">9) OpenGL/GLM/ImGui 知识点速查</h2>
<h3 id="opengl">OpenGL</h3>
<ul>
<li>坐标与裁剪空间
<ul>
<li>GLM 默认右手坐标；投影/视图组合后在 NDC（-1..1）进行裁剪</li>
</ul>
</li>
<li>透视投影
<ul>
<li><code>glm::perspective&lt;float&gt;(fovyRadians, aspect, zNear, zFar)</code></li>
<li>建议在调用处保证参数为 <code>float</code>，并包含 <code>glm/gtc/matrix_transform.hpp</code> 或 <code>glm/ext/matrix_clip_space.hpp</code></li>
</ul>
</li>
<li>深度测试/写入
<ul>
<li>常规绘制：<code>glDepthFunc(GL_LESS)</code>，写入开启</li>
<li>天空盒：<code>glDepthFunc(GL_LEQUAL)</code> + 关闭深度写（<code>glDepthMask(GL_FALSE)</code>）</li>
</ul>
</li>
<li>剔除与绕序
<ul>
<li>调试期可关闭剔除：<code>glDisable(GL_CULL_FACE)</code>；开启后需保证绕序一致（默认 CCW）</li>
</ul>
</li>
<li>Framebuffer
<ul>
<li>颜色附件纹理（采样展示）+ 深度/模板（RBO）</li>
<li>Resize 时需删除并重建附件；Bind 时更新 Viewport</li>
</ul>
</li>
<li>纹理图集
<ul>
<li>统一采样器数组（绑定到各纹理单元）</li>
<li>UV 区块需留 padding 抗 bleeding，边缘使用 CLAMP 或适当的采样策略</li>
</ul>
</li>
</ul>
<h3 id="glm">GLM</h3>
<ul>
<li>角度：<code>glm::radians(deg)</code> / <code>glm::degrees(rad)</code></li>
<li>相机：<code>glm::lookAt(eye, center, up)</code></li>
<li>常见 include
<ul>
<li>变换：<code>#include &lt;glm/gtc/matrix_transform.hpp&gt;</code></li>
<li>透视/正交：<code>#include &lt;glm/ext/matrix_clip_space.hpp&gt;</code>（可选增强）</li>
</ul>
</li>
</ul>
<h3 id="imgui">ImGui</h3>
<ul>
<li>Docking 启用后可自由布局</li>
<li>图像显示需注意 UV 翻转（OpenGL 纹理原点与 ImGui 的期望可能不同）</li>
<li>面板尺寸变化通过 <code>GetContentRegionAvail()</code> 获取并回传给渲染层</li>
</ul>
<hr>
<h2 id="10-构建与运行">10) 构建与运行</h2>
<ul>
<li>依赖：本地 <code>vcpkg/</code> 已在工程中集成；CMake Presets 指向对应 triplet 与工具链</li>
<li>构建（示例）
<ul>
<li>Debug：<code>build/x64-debug</code> 目录内生成 <code>TemplateProject.exe</code></li>
<li>Release：<code>build/x64-release</code></li>
</ul>
</li>
<li>资源
<ul>
<li>CMake 构建过程会将 <code>assets/</code> 拷贝到输出 <code>bin/</code> 目录</li>
</ul>
</li>
</ul>
<hr>
<h2 id="11-性能与稳健性建议">11) 性能与稳健性建议</h2>
<ul>
<li>网格生成
<ul>
<li>继续剔除不可见面；分区块（Chunk）与懒加载可在大地图下提升性能</li>
</ul>
</li>
<li>渲染
<ul>
<li>使用索引缓冲、合并 draw call；必要时启用简单批处理</li>
<li>后续可引入 MSAA、sRGB 帧缓冲，或阴影贴图等效果</li>
</ul>
</li>
<li>编辑器/交互
<ul>
<li>为 Game 面板增加独立相机及输入切换</li>
<li>视口 letterboxing：保持目标纵横比时留黑避免拉伸</li>
</ul>
</li>
</ul>
<hr>
<h2 id="12-未来工作roadmap">12) 未来工作（Roadmap）</h2>
<ul>
<li>资源系统（热加载/引用计数）</li>
<li>场景与实体组件系统（ECS）</li>
<li>多渲染后端适配层（如未来接 Vulkan/DirectX）</li>
<li>离屏后期处理链（Bloom/SSR/ToneMapping）</li>
<li>跨平台构建与 CI</li>
</ul>
<hr>
<h2 id="13-术语表简">13) 术语表（简）</h2>
<ul>
<li>FBO（Framebuffer Object）：离屏渲染目标</li>
<li>RBO（Renderbuffer Object）：通常用于深度/模板附件</li>
<li>VAO/VBO/IBO：顶点数组/顶点缓冲/索引缓冲</li>
<li>NDC：标准设备坐标，裁剪后范围 [-1,1]</li>
<li>fBm：分形布朗运动（分形噪声叠加）</li>
<li>Ridged：脊状噪声（强调山脊）</li>
</ul>

            
            
        </body>
        </html>